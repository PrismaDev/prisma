var TimetableView=Backbone.View.extend({template:"",startH:7,endH:23,ndays:6,initialize:function(){this.template=_.template($("#timetable-template").html())},buildTableBody:function(){for(var a=document.createElement("tbody"),b=this.startH;b<this.endH;b++){var c=document.createElement("tr");$(c).append("<td>"+b+":00</td>");for(var d=0;d<this.ndays;d++)$(c).append("<td></td>");$(a).append(c)}return $(a).html()},resizeW:function(){},resizeH:function(){},fetchData:function(){return{days:"Segunda Terca Quarta Quinta Sexta Sabado".split(" "),
startH:7,endH:23,timetableBody:this.buildTableBody()}},returnTemplate:function(){return _.template($("#timetable-template").html(),this.fetchData())},render:function(){this.$el.html(this.template(this.fetchData()))}}),timetableView=new TimetableView,FaltacursarView=Backbone.View.extend({template:"",subjectDatatableView:"",subjectTableWrapper:"",classesDiv:"",subjectTable:"",subjectDatatable:"",subjectTableFilter:"",subjectTableHeader:"",subjectTableBody:"",initialize:function(){this.template=_.template($("#faltacursar-template").html())},
events:{"click #faltacursar-subject-table tr":"clickOnRow"},cache:function(){this.subjectTableWrapper=$("#faltacursar-subject-table_wrapper");this.classesDiv=$("#faltacursar-classes-div");this.subjectTable=$("#faltacursar-subject-table");this.subjectTableFilter=$("#faltacursar-subject-table_wrapper\t\t\t\t\t .dataTables_filter");this.subjectTableHeader=$("#faltacursar-subject-table_wrapper\t\t\t\t\t .dataTables_scrollHead");this.subjectTableBody=$("#faltacursar-subject-table_wrapper\t\t\t\t\t .dataTables_scrollBody")},
clickOnRow:function(a){a=$(a.target).parent("tr");$(a).hasClass("row_selected")?($(a).removeClass("row_selected"),$(this.subjectTableWrapper).addClass("whole").removeClass("half"),this.calculateTableScroll(),$(this.classesDiv).addClass("hidden")):($(this.subjectTable).find("tr.row_selected").removeClass("row_selected"),$(a).addClass("row_selected"),$(this.subjectTableWrapper).addClass("half").removeClass("whole"),this.calculateTableScroll(),$(this.classesDiv).removeClass("hidden"),$(this.classesDiv).addClass("almostHalf"),
faltacursarClasseslistView.resizeH(),faltacursarClasseslistView.resizeW())},calculateTableScroll:function(){var a=$(this.subjectTableWrapper).height(),b=$(this.subjectTableFilter).outerHeight(!0)+$(this.subjectTableHeader).outerHeight(!0),c=$(this.subjectTableBody).outerHeight(!0)-$(this.subjectTableBody).height();$(this.subjectTableBody).height(a-b-c)},resizeW:function(){this.subjectDatatable.fnAdjustColumnSizing(!1);this.calculateTableScroll();faltacursarClasseslistView.resizeW()},resizeH:function(){this.calculateTableScroll();
faltacursarClasseslistView.resizeH()},initJS:function(){this.subjectDatatable=$("#faltacursar-subject-table").dataTable({sDom:"ft",bPaginate:!1,bScrollCollapse:!0,sScrollY:"200px"});$("#faltacursar-subject-table_wrapper").addClass("whole")},fetchStrings:function(){return{codeStr:"Codigo",nameStr:"Nome da Disciplina",moreInfoStr:"Ementa",termStr:"Periodo",infoStr:"Ementa"}},fetchSubjects:function(){return{subjects:[{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",
term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"ENG1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",
name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",term:"2",link:"#"},{code:"MAT1015",name:"Teste teste teste",
term:"2",link:"#"}]}},fetchData:function(){return $.extend({},this.fetchStrings(),this.fetchSubjects())},render:function(){this.$el.html(this.template(this.fetchData()));this.initJS();this.cache();faltacursarClasseslistView.setElement("#faltacursar-classes-div");faltacursarClasseslistView.render([])}}),faltacursarView=new FaltacursarView,MicrohorarioView=Backbone.View.extend({template:"",waitingTemplate:"",noQueryTemplate:"",resultsDiv:"",noQueryStatus:"noQuery",queryStatus:"query",waitingStatus:"waiting",
waitingImgURL:"http://i.stack.imgur.com/FhHRx.gif",resizeW:function(){},resizeH:function(){},events:{"click #moreFiltersButton":"moreFilters","click #lessFiltersButton":"lessFilters","click #openFiltersButton":"openFilters","click #closeFiltersButton":"closeFilters"},moreFilters:function(){$("#hiddenFilters").removeClass("hidden");$("#lessFiltersButton").removeClass("hidden");$("#moreFiltersButton").addClass("hidden")},lessFilters:function(){$("#hiddenFilters").addClass("hidden");$("#lessFiltersButton").addClass("hidden");
$("#moreFiltersButton").removeClass("hidden")},openFilters:function(){$("#microhorario-filter").removeClass("hidden");$("#openFiltersButton").addClass("hidden");$("#closeFiltersButton").removeClass("hidden")},closeFilters:function(){$("#microhorario-filter").addClass("hidden");$("#openFiltersButton").removeClass("hidden");$("#closeFiltersButton").addClass("hidden")},initialize:function(){this.template=_.template($("#microhorario-template").html());this.waitingTemplate=_.template($("#microhorario-waiting-template").html());
this.noQueryTemplate=_.template($("#microhorario-noquery-template").html())},changeState:function(a,b){void 0==typeof b&&(b=[]);a==this.queryStatus?(microhorarioClasseslistView.render(b),this.closeFilters()):a==this.noQueryStatus?this.$resultsDiv.html(this.noQueryTemplate({noQueryStr:"No query"})):this.$resultsDiv.html(this.waitingTemplate({waitingImgURL:this.waitingImgURL}))},fetchStrings:function(){return{noQueryStr:"No query",subjectCodeStr:"Codigo da Disciplina:",subjectNameStr:"Nome da Disciplina:",
professorNameStr:"Nome do Professor:",toggleBlocked:"Exibir disciplinas bloqueadas",moreFiltersStr:"More filters",lessFiltersStr:"Less filters",openFiltersStr:"Open filters",closeFiltersStr:"Close filters"}},render:function(){this.$el.html(this.template(this.fetchStrings()));this.$resultsDiv=$("#microhorario-results");microhorarioClasseslistView.setElement(this.$resultsDiv);this.changeState(this.queryStatus)}}),microhorarioView=new MicrohorarioView,DatatableView=Backbone.View.extend({el:"",sDom:"t",
table:"",resizeW:function(){table.fnDraw()},resizeH:function(){this.$el.height()},initialize:function(){void 0!=this.options.sDom&&(this.sDom=this.options.sDom);el=this.options.el;this.table=this.$el.dataTable({sDom:this.options.sDom})}}),SelectedView=Backbone.View.extend({events:{"click #main-selected-div li":"handleClick"},handleClick:function(a){if($(a.target).hasClass("btn-primary"))$(a.target).removeClass("btn-primary");else{var b=a.target.parent();$($(b).find("li")).each(function(a,b){$(b).removeClass("btn-primary")});
$(a.target).addClass("btn-primary")}},resizeW:function(){},resizeH:function(){},sortableConfig:function(a){var b=this;$(a).sortable({connectWith:".selectedSortable",receive:function(a,d){3<$(this).children().length&&$(d.sender).sortable("cancel");0==$(d.sender).children().length&&$(d.sender).remove();if($("#main-selected-div ul").last().children().length){var e=document.createElement("ul");$(e).addClass("selectedSortable");$("#main-selected-div").append(e);b.sortableConfig(e)}}})},initJS:function(){this.sortableConfig("#main-selected-div ul")},
buildRow:function(a){var b=document.createElement("ul");$(b).addClass("selectedSortable");for(var c=0;c<a.length;c++)c?$(b).append('<li class="btn disabled">'+a[c].subcode+"-"+a[c].classcode+"</li>"):$(b).append('<li class="btn btn-primary disabled">'+a[0].subcode+"-"+a[0].classcode+"</li>");return b},buildSelected:function(a){var b=document.createElement("div");a[a.length]=[];for(var c=0;c<a.length;c++)$(b).append(this.buildRow(a[c]));return $(b).html()},fetchData:function(){return[[{subcode:"ENG1232",
classcode:"3VA"},{subcode:"ENG1232",classcode:"3VA"}],[{subcode:"ENG1232",classcode:"3VA"}],[{subcode:"ENG1232",classcode:"3VA"},{subcode:"ENG1232",classcode:"3VA"},{subcode:"ENG1232",classcode:"3VA"}]]},render:function(){var a=this.fetchData();this.$el.html(this.buildSelected(a));this.initJS()}}),selectedView=new SelectedView,MainView=Backbone.View.extend({el:"body",template:"",rendered:!1,tabs:{faltacursar:{li:"main-faltacursar-li",div:"main-faltacursar-div",str:"",href:"#faltacursar",view:faltacursarView},
microhorario:{li:"main-microhorario-li",div:"main-microhorario-div",str:"",href:"#microhorario",view:microhorarioView},selected:{li:"main-selected-li",div:"main-selected-div",str:"",href:"#selected",view:selectedView}},defaultTab:"faltacursar",childrenViews:[faltacursarView,timetableView,selectedView,microhorarioView],timetableDiv:"",sidebarDiv:"",timetableTable:"",container:"",tabsNav:"",initialize:function(){this.template=_.template($("#main-template").html());this.fetchStrings();var a=this;$(window).resize(function(){a.resizeW();
a.resizeH()})},cache:function(){this.timetableDiv=$("#main-timetable-div");this.sidebarDiv=$("#main-sidebar-div");this.timetableTable=$("#main-timetable-div table");this.container=$("#container-div");this.tabsNav=$("#main-tabs-nav")},resizeW:function(){this.setTimetableWFromSidebarW();$.each(this.childrenViews,function(a,b){b.resizeW()})},resizeH:function(){this.equalMainDivsHeight();$.each(this.childrenViews,function(a,b){b.resizeH()})},setTimetableWFromSidebarW:function(){var a=$(this.container).width(),
b=$(this.sidebarDiv).outerWidth(!0),c=$(this.sidebarDiv).width(),d=$(this.timetableDiv).outerWidth(!0),e=$(this.timetableDiv).width(),f=a-b;$(this.timetableDiv).width(f-(d-e)-1);$(this.timetableDiv).width()<$(this.timetableTable).width()&&(f=a-d,$(this.timetableDiv).width(e),$(this.sidebarDiv).width(f-(b-c)-1))},initJS:function(){var a=0;$(this.tabsNav).find("li").each(function(){a+=$(this).outerWidth(!0)});a+=1;$(this.sidebarDiv).resizable({handles:"e, w",minWidth:a,containment:"parent",resize:this.setTimetableWFromSidebarW})},
setActiveTab:function(a){$("#main-tabs-nav li").removeClass("active");$("#main-tab-panes div").removeClass("active");$("#"+this.tabs[a].li).addClass("active");$("#"+this.tabs[a].div).addClass("active");this.tabs[a].view.resizeW();this.tabs[a].view.resizeH()},fetchStrings:function(){this.tabs.faltacursar.str="Falta Cursar";this.tabs.microhorario.str="Micro Horario";this.tabs.selected.str="Selecionadas"},renderSubviews:function(){timetableView.setElement("#main-timetable-div");timetableView.render();
faltacursarView.setElement("#main-faltacursar-div");faltacursarView.render();microhorarioView.setElement("#main-microhorario-div");microhorarioView.render();selectedView.setElement("#main-selected-div");selectedView.render()},equalMainDivsHeight:function(){var a=$(this.timetableDiv).height();$(this.sidebarDiv).height(a);a-=this.tabsNav.height();faltacursarView.$el.height(a);microhorarioView.$el.height(a);selectedView.$el.height(a)},render:function(){this.$el.html(this.template({tabs:this.tabs}));
this.renderSubviews();this.rendered=!0;this.cache();this.initJS();this.resizeW();this.resizeH()}}),mainView=new MainView,ClasseslistView=Backbone.View.extend({template:"",classesDatatable:"",resizeW:function(){this.classesDatatable.fnAdjustColumnSizing(!1)},resizeH:function(){},initialize:function(){this.template=_.template($("#classeslist-template").html())},initJS:function(){this.classesDatatable=this.$el.find("table").dataTable({sDom:this.options.sDom,bPaginate:!1,bScrollCollapse:!0,sScrollY:"200px"})},
render:function(a){this.$el.html(this.template(a));this.initJS()}}),microhorarioClasseslistView=new ClasseslistView({sDom:"t"}),faltacursarClasseslistView=new ClasseslistView({sDom:"ft"});function SelectedController(){}var selectedController=new SelectedController,MainRouter=Backbone.Router.extend({routes:{"":"main",":tab":"tabs"}}),mainRouter=new MainRouter;mainRouter.on("route:main",function(){mainView.render();mainRouter.navigate(mainView.defaultTab,{trigger:!0})});
mainRouter.on("route:tabs",function(a){if(!mainView.tabs[a])return mainRouter.navigate(mainView.defaultTab,{trigger:!0,replace:!0});mainView.rendered||mainView.render();mainView.setActiveTab(a)});Backbone.history.start();
